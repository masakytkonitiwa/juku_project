{% extends 'homework/base.html' %}
{% load static %}
{% load homework_extras %}

{% block title %}å®¿é¡Œç™»éŒ² Step 7{% endblock %}

<body class="text-6xl">
{% block content %}

<!-- ã‚¹ãƒ†ãƒƒãƒ—ãƒãƒ¼ -->
<div class="arrow-steps">
  <div class="step done">1</div>
  <div class="step done">2</div>
  <div class="step done">3</div>
  <div class="step done">4</div>
  <div class="step done">5</div>
  <div class="step done">6</div>
  <div class="step current">7</div>
</div>

<h2 class="text-2xl my-6">â‘¦ ç¢ºèªã¨ç™»éŒ²</h2>

<!-- ç™»éŒ²å†…å®¹ã®ç¢ºèª -->
<div class="text-xl my-6">
  <p><strong>ç§‘ç›®:</strong> {{ subject }}</p>
  <p><strong>ã‚³ãƒ¼ã‚¹:</strong> {{ course }}</p>
  <p><strong>å•é¡Œã‚¿ã‚¤ãƒ—:</strong> {{ problem_type }}</p>
  <p><strong>å•é¡Œæ•°:</strong> {{ problem_count }}</p>
  <p><strong>å‘¨å›æ•°:</strong> {{ cycles }}</p>
  <p><strong>é¸æŠã—ãŸæ—¥ä»˜:</strong> {{ selected_dates|join:", " }}</p>
</div>

{% if selected_subject %}
  <div class="bg-gray-100 p-4 rounded-xl mb-4 text-xl text-gray-700 shadow">
    âœ… é¸æŠã—ãŸç§‘ç›®ï¼š<strong>{{ selected_subject.name }}</strong>
  </div>
{% endif %}

{% if selected_course %}
  <div class="bg-gray-100 p-4 rounded-xl mb-6 text-xl text-gray-700 shadow">
    ğŸ“˜ é¸æŠã—ãŸã‚³ãƒ¼ã‚¹ï¼š<strong>{{ selected_course.name }}</strong>
  </div>
{% endif %}


<!-- å®¿é¡Œã®ç¢ºèª -->
<h3 class="text-xl my-6">å®¿é¡Œã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h3>
<div class="bg-gray-100 p-6 rounded-lg shadow-md">
  <ul>
    {% for task in scheduled_tasks %}
      <li><strong>{{ task.date }}:</strong> {{ task.task }}</li>
    {% endfor %}
  </ul>
</div>



<!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º -->
<h3 class="text-xl my-6">æ—¥ä»˜ã‚’é¸æŠã—ãŸã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h3>
<form method="post">
  {% csrf_token %}

  <input type="hidden" name="subject" value="{{ subject }}">
  <input type="hidden" name="course" value="{{ course }}">
  <input type="hidden" name="problem_type" value="{{ problem_type }}">
  <input type="hidden" name="problem_count" value="{{ problem_count }}">
  <input type="hidden" name="cycles" value="{{ cycles }}">
  <input type="hidden" name="selected_dates" id="selected_dates">

  <!-- æœ€åˆã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡Œé–‹å§‹ -->
  <div class="calendar">
    {% for day in calendar_days %}
      {% with day_str=day|date:'Y-m-d' %}
      <div class="day {% if day in selected_dates %}selected{% endif %} {% if day == today %}today{% endif %}" data-date="{{ day_str }}">
        {{ day|date:"m/d (D)" }}

        <!-- ã‚¤ãƒ™ãƒ³ãƒˆ -->
        {% for ev in events_by_day|get_item:day %}
          <div class="bg-yellow-100 text-sm">ğŸ“… {{ ev.name }}</div>
        {% endfor %}

        <!-- æˆæ¥­ -->
        {% for lesson in lessons_by_day|get_item:day %}
          <div class="bg-orange-100 text-sm">
            {{ lesson.subject.name }}/{{ lesson.course.name }}
          </div>
        {% endfor %}

        <!-- æ—¢å­˜å®¿é¡Œ -->
        {% for hw_entry in homeworks_by_day|get_item:day %}
          <div class="bg-blue-100 text-sm">
            ğŸ“‹ {{ hw_entry.task }}
          </div>
        {% endfor %}


        {% for task in scheduled_tasks %}
        {% if task.date|stringformat:"s" == day_str %}
          <div class="bg-blue-200 text-sm">
            ğŸ“ {{ task.subject }} / {{ task.course }}<br>
            {{ task.task }}
          </div>
        {% endif %}
      {% endfor %}
      


      </div>
      {% endwith %}

      <!-- 7æ—¥ã”ã¨ã«æ–°ã—ã„é€±ã®è¡Œã‚’é–‹å§‹ -->
      {% if forloop.counter|divisibleby:7 and not forloop.last %}
        </div><div class="calendar">
      {% endif %}
    {% endfor %}
  </div>  <!-- æœ€çµ‚çš„ãªã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡Œã®çµ‚äº† -->

  <div class="text-center mt-10">
    <button type="submit" class="bg-green-500 hover:bg-green-700 text-white text-3xl font-bold py-4 px-8 rounded-xl shadow-lg">
      ç™»éŒ²ã™ã‚‹
    </button>
  </div>
</form>



<!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
<div class="mt-10 text-center">
  <a href="{% url 'homework_wizard_step6' %}" class="bg-green-400 hover:bg-green-600 text-white text-3xl font-bold py-4 px-8 rounded-xl shadow-lg inline-block">
    â† æˆ»ã‚‹
  </a>
</div>


{% endblock %}
</body>
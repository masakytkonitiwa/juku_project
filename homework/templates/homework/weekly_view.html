{% extends 'homework/base.html' %}

{% load homework_extras %}

{% block title %}é€±é–“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼{% endblock %}

{% block content %}
    <!-- ğŸ”¥ ã“ã“ã«å…¥ã‚Œã‚‹ -->
    <form method="get" action="{% url 'weekly_view' %}" style="margin-bottom: 20px;">
        <label for="view_mode">è¡¨ç¤ºå½¢å¼:</label>
        <select name="view_mode" id="view_mode" onchange="this.form.submit()">
            <option value="3weeks" {% if view_mode == '3weeks' %}selected{% endif %}>å…ˆé€±ãƒ»ä»Šé€±ãƒ»æ¥é€±</option>
            <option value="month" {% if view_mode == 'month' %}selected{% endif %}>æœˆã”ã¨</option>
            <option value="test" {% if view_mode == 'test' %}selected{% endif %}>æ¬¡ã®å…¬é–‹å­¦åŠ›ãƒ†ã‚¹ãƒˆã¾ã§</option>
        </select>
    </form>


    <p style="margin-bottom: 20px;">
        <a href="{% url 'add_homework' %}" style="padding: 8px 12px; background-color: #2196F3; color: white; border-radius: 4px; text-decoration: none; margin-right: 10px;">
            â• å®¿é¡Œã‚’è¿½åŠ 
        </a>
        <a href="{% url 'add_event' %}" style="padding: 8px 12px; background-color: #4CAF50; color: white; border-radius: 4px; text-decoration: none;">
            â• ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
        </a>
        <a href="{% url 'add_lesson' %}" style="padding: 8px 12px; background-color: #FF9800; color: white; border-radius: 4px; text-decoration: none; margin-left: 10px;">
            â• æˆæ¥­ã‚’è¿½åŠ 
        </a>
    </p>
    
    <h2>ğŸ—“ï¸ å¡¾ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2>
    <div class="calendar-wrapper">

    <table>
        <!-- æ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        {% for week in weeks %}
        <tr>
            {% for day in week %}
                <th>{{ day|date:"mæœˆdæ—¥ (D)" }}</th>
            {% endfor %}
        </tr>
    
        <!-- å®¿é¡Œãƒ»ã‚¤ãƒ™ãƒ³ãƒˆ -->
        <tr>
            {% for day in week %}
                <td class="{% if day == today %}today{% endif %}"> 
                    <!-- ã‚¤ãƒ™ãƒ³ãƒˆ -->
                    {% for ev in events_by_day|get_item:day %}
                        <div>ğŸ“… {{ ev.name }} <a href="{% url 'delete_event' ev.id %}" style="color:red;">âŒ</a></div>
                    {% endfor %}

 

                    <!-- æˆæ¥­è¡¨ç¤º -->
                    {% for lesson in lessons_by_day|get_item:day %}
                    <div style="background-color: #ffe0b3; font-size: 0.8em; margin: 2px 0;">
                        æˆæ¥­ {{ lesson.subject.name }} / {{ lesson.course.name }}
                        {{ lesson.start_time|time:"H:i" }}ã€œ{{ lesson.end_time|time:"H:i" }}
                        <a href="{% url 'delete_lesson' lesson.id %}" style="color:red;">âŒ</a>  <!-- å‰Šé™¤ãƒœã‚¿ãƒ³è¿½åŠ ï¼ -->
                    </div>
                    {% endfor %}
                    
                    <!-- å®¿é¡Œ -->
                    {% for hw_entry in homeworks_by_day|get_item:day %}
                    <div class="homework-box subject-{{ hw_entry.detail.homework.subject }}">
                        {{ hw_entry.detail.homework.get_subject_display }}<br>
                        ğŸ« {{ hw_entry.detail.get_course_display }} / {{ hw_entry.detail.get_problem_type_display }}<br>
                        ğŸ“‹ {{ hw_entry.task }}
                        <!-- ğŸ”¥ å‰Šé™¤ãƒœã‚¿ãƒ³ -->
                        <form method="post" action="{% url 'delete_homework' hw_entry.detail.homework.id %}" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" style="background:none; border:none; color:red; cursor:pointer; font-size:0.8em; padding:0;">âŒ</button>

                        </form>
                    </div>
                    {% endfor %}
                </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </table>
    </div>
    {% endblock %}
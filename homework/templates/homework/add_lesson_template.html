{% extends 'homework/base.html' %}
{% load static %}
{% block title %}æˆæ¥­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ{% endblock %}

{% block content %}


    <h1>æˆæ¥­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆâ‘ ã€œâ‘¤</h1>

    <!-- ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form method="post">
        {% csrf_token %}


        {% if form.non_field_errors %}
            <div style="color: red; margin-bottom: 1rem;">
                {% for error in form.non_field_errors %}
                    <p>{{ error }}</p>
                {% endfor %}
            </div>
        {% endif %}


        <h2>â‘ ç§‘ç›®ã‚’é¸æŠ</h2>
            <div class="button-group">
                {% for value, label in subject_choices %}
                    <button type="button" class="subject-button" data-value="{{ value }}">{{ label }}</button>
                {% endfor %}

                <!-- ğŸ”¥ ç§‘ç›®ã®è¿½åŠ ãƒœã‚¿ãƒ³ -->
                <a href="{% url 'subject_template_list' %}" class="subject-button" style="text-decoration: none;">
                    â• ç§‘ç›®ã‚’è¿½åŠ ãƒ»å‰Šé™¤
                </a>
            </div>

        <input type="hidden" name="subject" id="id_subject">
            
        <!-- ä»Šå¾Œã“ã“ã«ã‚³ãƒ¼ã‚¹ãƒ»æ™‚é–“ã®ãƒœã‚¿ãƒ³ã‚‚è¿½åŠ ã—ã¾ã™ -->

        <h2>â‘¡ã‚³ãƒ¼ã‚¹ã‚’é¸æŠ</h2>
        <div class="button-group">
            {% for value, label in course_choices %}
                {% if value %}
                <button type="button" class="course-button" data-value="{{ value }}">{{ label }}</button>
                {% endif %}
            {% endfor %}

            <!-- ğŸ”¥ ã‚³ãƒ¼ã‚¹ã®è¿½åŠ ãƒœã‚¿ãƒ³ -->
            <a href="{% url 'course_template_list' %}" class="course-button" style="text-decoration: none;">
                â• ã‚³ãƒ¼ã‚¹ã‚’è¿½åŠ ãƒ»å‰Šé™¤
            </a>
        </div>

        <input type="hidden" name="course" id="id_course">

        <h2>â‘¢æˆæ¥­é–‹å§‹æ™‚åˆ»</h2>
        <input type="time" name="start_time" id="id_start_time" step="300" class="time-input">

        <h2>â‘£æˆæ¥­çµ‚äº†æ™‚åˆ»</h2>
        <input type="time" name="end_time" id="id_end_time" step="300" class="time-input">



        <div class="text-center mb-5xl">
            <button type="submit" class="next-button" style="margin-top: 20px;">â‘¤ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆ</button>
        </div>
    </form>

    <h2>ä½œæˆæ¸ˆã¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h2>
    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
        {% for template in templates %}
        <div style="border: 1px solid #ccc; border-radius: 8px; padding: 10px; width: 200px; background-color: #fff;">
            <div style="font-size: 1.1em; margin-bottom: 5px;">
                ğŸ“ <strong>{{ template.subject.name }}</strong>
            </div>
            <div>
                ğŸ« {{ template.course.name }}<br>
                ğŸ•’ {{ template.start_time|time:"H:i" }}ã€œ{{ template.end_time|time:"H:i" }}
            </div>
            
            <div style="text-align: right; margin-top: 8px;">
                <a href="{% url 'delete_lesson_template' template.id %}" style="padding: 4px 8px; background-color: #f44336; color: white; border-radius: 4px; text-decoration: none; font-size: 0.9em;">
                    âŒ å‰Šé™¤
                </a>
            </div>
        </div>
        {% empty %}
        <p>ã¾ã ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        {% endfor %}
    </div>
    <div class="text-center mb-5xl">
        <a href="{% url 'lesson_wizard_step1' %}" class="back-button">
          æˆ»ã‚‹
        </a>
    </div>

    <script>
        document.querySelectorAll('.subject-button').forEach(button => {
            button.addEventListener('click', () => {
                const hiddenInput = document.getElementById('id_subject');

                if (button.classList.contains('selected')) {
                    // é¸æŠæ¸ˆã¿ â†’ è§£é™¤
                    button.classList.remove('selected');
                    hiddenInput.value = '';
                } else {
                    // æ–°ãŸã«é¸æŠ
                    document.querySelectorAll('.subject-button').forEach(b => b.classList.remove('selected'));
                    button.classList.add('selected');
                    hiddenInput.value = button.dataset.value;
                }
            });
        });




        document.querySelectorAll('.course-button').forEach(button => {
            button.addEventListener('click', () => {
                const hiddenInput = document.getElementById('id_course');

                if (button.classList.contains('selected')) {
                    // é¸æŠè§£é™¤
                    button.classList.remove('selected');
                    hiddenInput.value = '';
                } else {
                    // æ–°ã—ãé¸æŠ
                    document.querySelectorAll('.course-button').forEach(b => b.classList.remove('selected'));
                    button.classList.add('selected');
                    hiddenInput.value = button.dataset.value;
                }
            });
        });
        </script>
        

{% endblock %}

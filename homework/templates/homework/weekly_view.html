{% extends 'homework/base.html' %}
{% load homework_extras %}

{% block title %}é€±é–“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼{% endblock %}

{% block content %}
<div class="text-3xl">



{% if view_mode == "div" %}
<!-- ğŸ“± ã‚¹ãƒãƒ›ç”¨ ç¸¦è¡¨ç¤º -->
<!-- ğŸ”¼ ä¸Šéƒ¨ä½™ç™½ã‚’è¿½åŠ  -->
<div class="mt-40"></div>
<div class="flex flex-col gap-4">
  {% for day in week_days %}
  <div class="bg-white rounded-xl shadow p-4 border {% if day == today %}ring-2 ring-blue-400{% endif %}">
    
    <!-- ğŸ¨ æ—¥ä»˜ -->
    <div class="text-3xl font-bold mb-2
        {% if day == today %}
            text-blue-800
        {% elif day|date:'w' == '6' %}
            text-red-600
        {% elif day|date:'w' == '0' %}
            text-blue-600
        {% else %}
            text-gray-700
        {% endif %}
    ">
      {{ day|date:"m/d (D)" }}
    </div>

    <!-- ğŸ“… ã‚¤ãƒ™ãƒ³ãƒˆ -->
    {% for ev in events_by_day|get_item:day %}
    <div class="bg-yellow-100 rounded px-2 py-1 mb-1 text-3xl">
      ğŸ“… {{ ev.name }}
      <a href="{% url 'delete_event' ev.id %}" class="text-red-500 ml-2 text-3xl">âŒ</a>
    </div>
    {% endfor %}

    <!-- ğŸ“˜ æˆæ¥­ -->
    {% for lesson in lessons_by_day|get_item:day %}
    <div class="bg-orange-100 rounded px-2 py-1 mb-1 text-3xl">
      ğŸ“˜ {{ lesson.subject.name }} / {{ lesson.course.name }}ï¼ˆ{{ lesson.start_time|time:"H:i" }}ã€œ{{ lesson.end_time|time:"H:i" }})

    </div>
    {% endfor %}

    <!-- ğŸ“‹ å®¿é¡Œ -->
    {% for hw_entry in homeworks_by_day|get_item:day %}
    <div class="bg-green-100 rounded px-2 py-1 mb-1 text-3xl">
      ğŸ“š {{ hw_entry.detail.homework.get_subject_display }}<br>
      ğŸ« {{ hw_entry.detail.get_course_display }}<br>
      ğŸ“‹ {{ hw_entry.task }}
      <form method="post" action="{% url 'delete_homework' hw_entry.detail.homework.id %}">
        {% csrf_token %}
        <button type="submit" class="text-red-500 text-3xl ml-1">âŒ</button>
      </form>
    </div>
    {% endfor %}

  </div>
  {% endfor %}
</div>
{% endif %}



<!-- ğŸ–¥ï¸ ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºï¼ˆPCç”¨ï¼‰ -->
{% if view_mode != 'div' %}
<h2 class="text-3xl font-bold mb-4">ğŸ—“ï¸ å¡¾ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆ{{ view_mode }}ï¼‰</h2>
<div class="calendar-wrapper">
  <table>
    <!-- æ›œæ—¥è¡Œ -->
    <tr>
      {% for day in weeks.0 %}
      <th>{{ day|date:"D" }}</th>  <!-- D = æ›œæ—¥ï¼ˆä¾‹: æœˆ, ç«ï¼‰ -->
      {% endfor %}
    </tr>
    <!-- æ—¥ä»˜ + å†…å®¹è¡Œ -->
    {% for week in weeks %}
    <tr>
      {% for day in week %}
      <td class="{% if day == today %}today{% endif %}">
        <div class="font-bold mb-1">{{ day|date:"m/d" }}</div>

        {% for ev in events_by_day|get_item:day %}
          <div>ğŸ“… {{ ev.name }} <a href="{% url 'delete_event' ev.id %}" style="color:red;">âŒ</a></div>
        {% endfor %}

        {% for lesson in lessons_by_day|get_item:day %}
        <div style="background-color: #ffe0b3; font-size: 0.9em; margin: 2px 0;">
          æˆæ¥­ {{ lesson.subject.name }} / {{ lesson.course.name }}
          {{ lesson.start_time|time:"H:i" }}ã€œ{{ lesson.end_time|time:"H:i" }}
          <a href="{% url 'delete_lesson' lesson.id %}" style="color:red;">âŒ</a>
        </div>
        {% endfor %}

        {% for hw_entry in homeworks_by_day|get_item:day %}
        <div class="homework-box subject-{{ hw_entry.detail.homework.subject }}">
          {{ hw_entry.detail.homework.get_subject_display }}<br>
          ğŸ« {{ hw_entry.detail.get_course_display }} / {{ hw_entry.detail.get_problem_type_display }}<br>
          ğŸ“‹ {{ hw_entry.task }}
          <form method="post" action="{% url 'delete_homework' hw_entry.detail.homework.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" style="background:none; border:none; color:red; cursor:pointer; font-size:0.8em; padding:0;">âŒ</button>
          </form>
        </div>
        {% endfor %}
      </td>
      {% endfor %}
    </tr>
    {% endfor %}
  </table>
</div>
{% endif %}

    <!-- æœ€å¾Œã®ä½™ç™½ -->
    <div class="h-120"></div>
</div>




<!-- ğŸ“Œ ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€Œï¼‹ã€ï¼‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
<div id="fab-container" class="fixed bottom-6 right-6 z-50 flex flex-col items-end space-y-3">
  <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆãƒ›ãƒãƒ¼æ™‚è¡¨ç¤ºï¼‰ -->
  <div id="fab-menu" class="hidden flex flex-col items-end space-y-4">
    <a href="{% url 'homework_wizard_step1' %}"
       class="bg-green-500 hover:bg-green-600 text-white text-6xl font-bold px-6 py-4 rounded-xl shadow-lg">
      â• å®¿é¡Œã‚’è¿½åŠ 
    </a>
    <a href="{% url 'add_event_step1' %}"
       class="bg-yellow-500 hover:bg-yellow-600 text-white text-6xl font-bold px-6 py-4 rounded-xl shadow-lg">
      ğŸ—“ï¸ ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
    </a>
    <a href="{% url 'lesson_wizard_step1' %}"
       class="bg-red-500 hover:bg-red-600 text-white text-6xl font-bold px-6 py-4 rounded-xl shadow-lg">
      ğŸ“š æˆæ¥­ã‚’è¿½åŠ 
    </a>
  </div>

  <!-- ï¼‹ãƒœã‚¿ãƒ³ -->
  <button
    class="w-36 h-36 rounded-full bg-blue-500 text-white text-6xl shadow-lg flex items-center justify-center hover:bg-blue-600">
    ï¼‹
  </button>
</div>





<!-- ğŸ“… è¡¨ç¤ºåˆ‡æ›¿ FABï¼ˆå·¦ä¸Šï¼‰ -->
<div id="view-menu-container" class="fixed top-6 left-6 z-50 text-left">
  <!-- ãƒœã‚¿ãƒ³æœ¬ä½“ -->
  <button
    class="w-36 h-36 rounded-full bg-purple-500 text-white text-6xl shadow-lg flex items-center justify-center hover:bg-purple-600">
    â‰¡
  </button>

  <!-- ğŸ”½ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
  <div id="view-menu" class="hidden mt-3 space-y-4">
    <form method="get" action="{% url 'weekly_view' %}">
      <input type="hidden" name="view_mode" value="div">
      <button type="submit"
              style="font-size: 5rem;"
              class="block w-full bg-blue-500 hover:bg-blue-600 text-white text-6xl font-bold px-6 py-4 rounded-lg shadow">
        ğŸ“± ã‚¹ãƒãƒ›ç”¨ç¸¦è¡¨ç¤º
      </button>
    </form>
    <form method="get" action="{% url 'weekly_view' %}">
      <input type="hidden" name="view_mode" value="3weeks">
      <button type="submit"
              style="font-size: 5rem;"
              class="block w-full bg-blue-500 hover:bg-blue-600 text-white text-9xl font-bold px-6 py-4 rounded-lg shadow">
        ğŸ“… 3é€±é–“
      </button>
    </form>
    <form method="get" action="{% url 'weekly_view' %}">
      <input type="hidden" name="view_mode" value="month">
      <button type="submit"
              style="font-size: 5rem;"
              class="block w-full bg-blue-500 hover:bg-blue-600 text-white text-6xl font-bold px-6 py-4 rounded-lg shadow">
        ğŸ—“ï¸ æœˆè¡¨ç¤º
      </button>
    </form>
    <form method="get" action="{% url 'weekly_view' %}">
      <input type="hidden" name="view_mode" value="test">
      <button type="submit"
              style="font-size: 5rem;"
              class="block w-full bg-blue-500 hover:bg-blue-600 text-white text-6xl font-bold px-6 py-4 rounded-lg shadow">
        ğŸ“ ãƒ†ã‚¹ãƒˆã¾ã§
      </button>
    </form>
  </div>
</div>

  

<script>
  const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

  // FABãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆå³ä¸‹ã®ï¼‹ï¼‰
  const fabContainer = document.getElementById("fab-container");
  const fabMenu = document.getElementById("fab-menu");

  // è¡¨ç¤ºåˆ‡æ›¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆå·¦ä¸Šã®â‰¡ï¼‰
  const viewMenuContainer = document.getElementById("view-menu-container");
  const viewMenu = document.getElementById("view-menu");

  if (isMobile) {
    // ã‚¹ãƒãƒ›ï¼šã‚¯ãƒªãƒƒã‚¯ã§é–‹é–‰ï¼ˆãƒˆã‚°ãƒ«ï¼‰
    let fabOpen = false;
    fabContainer.addEventListener("click", () => {
      fabOpen = !fabOpen;
      fabMenu.classList.toggle("hidden", !fabOpen);
    });

    let viewOpen = false;
    viewMenuContainer.addEventListener("click", () => {
      viewOpen = !viewOpen;
      viewMenu.classList.toggle("hidden", !viewOpen);
    });

    // ä»»æ„ï¼šå¤–éƒ¨ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
    document.addEventListener("click", (e) => {
      if (!fabContainer.contains(e.target)) {
        fabMenu.classList.add("hidden");
        fabOpen = false;
      }
      if (!viewMenuContainer.contains(e.target)) {
        viewMenu.classList.add("hidden");
        viewOpen = false;
      }
    });

  } else {
    // PCï¼šãƒ›ãƒãƒ¼ã§è¡¨ç¤ºãƒ»éè¡¨ç¤º
    fabContainer.addEventListener("mouseenter", () => {
      fabMenu.classList.remove("hidden");
    });
    fabContainer.addEventListener("mouseleave", () => {
      fabMenu.classList.add("hidden");
    });

    viewMenuContainer.addEventListener("mouseenter", () => {
      viewMenu.classList.remove("hidden");
    });
    viewMenuContainer.addEventListener("mouseleave", () => {
      viewMenu.classList.add("hidden");
    });
  }
</script>


{% endblock %}
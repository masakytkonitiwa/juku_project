
{% load static %}
{% load homework_extras %}
<!DOCTYPE html>
<html lang="ja">
<head>

    <meta charset="UTF-8">
    <title>å®¿é¡Œç™»éŒ²</title>
    <link rel="stylesheet" href="{% static 'homework/style.css' %}">


</head>
<body>
    <p style="text-align: right;">
        <a href="{% url 'weekly_view' %}" class="back-button">â† ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«æˆ»ã‚‹</a>
    </p>

    <h1>å®¿é¡Œç™»éŒ²</h1>

    <form method="post">
        {% csrf_token %}
        <h2>ç§‘ç›®ã‚’é¸æŠ</h2>
        <div id="subject-buttons" style="margin-bottom: 10px;">
            <button type="button" class="subject-button" data-value="japanese">å›½èª</button>
            <button type="button" class="subject-button" data-value="math">ç®—æ•°</button>
            <button type="button" class="subject-button" data-value="science">ç†ç§‘</button>
            <button type="button" class="subject-button" data-value="social">ç¤¾ä¼š</button>
            <button type="button" class="subject-button" data-value="english">è‹±èª</button>
            <button type="button" class="subject-button" data-value="other">ãã®ä»–</button>
        </div>
        <input type="hidden" name="subject" id="id_subject">

        <h2>ã‚³ãƒ¼ã‚¹ã‚’é¸æŠ</h2>
        <div id="course-buttons" style="margin-bottom: 10px;">
            <button type="button" class="course-button" data-value="master">ãƒã‚¹ã‚¿ãƒ¼ã‚³ãƒ¼ã‚¹</button>
            <button type="button" class="course-button" data-value="top_level">æœ€é«˜ãƒ¬ãƒ™ãƒ«ç‰¹è¨“</button>
            <button type="button" class="course-button" data-value="second">2nd</button>
        </div>
        <input type="hidden" name="course" id="id_course">

        
        <h2>å•é¡Œã‚¿ã‚¤ãƒ—ã‚’é¸æŠ</h2>
        <div id="problem-type-buttons" style="margin-bottom: 10px;">
            <button type="button" class="problem-type-button" data-value="practice">ç·´ç¿’å•é¡Œ</button>
            <button type="button" class="problem-type-button" data-value="b_problem">Bå•é¡Œ</button>
            <button type="button" class="problem-type-button" data-value="c_problem">Cå•é¡Œ</button>
        </div>
        <input type="hidden" name="problem_type" id="id_problem_type">


        <h2>å•é¡Œæ•°ã‚’é¸æŠ</h2>
        <div id="problem-count-buttons" style="margin-bottom: 10px;">
            {% for num in range_0_30 %}
                <button type="button" class="problem-count-button" data-value="{{ num }}">{{ num }}å•</button>
            {% endfor %}
        </div>
        <input type="hidden" name="problem_count" id="id_problem_count">


        <h2>å‘¨å›æ•°ã‚’é¸æŠ</h2>
        <div id="cycle-buttons" style="margin-bottom: 10px;">
            <button type="button" class="cycle-button" data-value="1">1å‘¨ã®ã¿</button>
            <button type="button" class="cycle-button" data-value="2">2å‘¨ï¼‹ç·å¾©ç¿’</button>
            <button type="button" class="cycle-button" data-value="3">3å‘¨ï¼‹ç·å¾©ç¿’</button>
        </div>
        <input type="hidden" name="cycles" id="id_cycles">

            <hr>

    
        <!-- ğŸ†• ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é¸æŠ -->
        <h2>å®¿é¡Œã‚’ã‚„ã‚‹æ—¥ã‚’é¸æŠ</h2>
        <input type="hidden" name="selected_dates" id="selected_dates">
        <button type="submit">ç™»éŒ²ã™ã‚‹</button>
    </form>

        <div class="calendar">
            {% for day in calendar_days %}
                
                <div class="day {% if day == today %}today{% endif %}" data-date="{{ day|date:'Y-m-d' }}">


                    {{ day|date:"m/d (D)" }}
                    <!-- ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤º -->
                    {% for ev in events_by_day|get_item:day %}
                        <div style="background-color: #e0e0e0; font-size: 0.8em; margin: 2px 0;">
                            ğŸ“… {{ ev.name }}
                                    <!-- ğŸ”¥ ã“ã“ã«å‰Šé™¤ãƒ•ã‚©ãƒ¼ãƒ è¿½åŠ  -->
                            <form method="post" action="{% url 'delete_event' ev.id %}" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" style="background:none; border:none; color:red; cursor:pointer; font-size:0.8em; padding:0;">âŒ</button>

                            </form>
                        </div>
                    {% endfor %}

                    <!-- ğŸ”¥ æˆæ¥­è¡¨ç¤º -->
                    {% for lesson in lessons_by_day|get_item:day %}
                    <div style="background-color: #ffe0b3; font-size: 0.8em; margin: 2px 0;">
                        ğŸ“ {{ lesson.get_subject_display }} / {{ lesson.get_course_display }}
                        {{ lesson.start_time|time:"H:i" }}ã€œ{{ lesson.end_time|time:"H:i" }}

                                <!-- ğŸ”¥ å‰Šé™¤ãƒœã‚¿ãƒ³ -->
                        <form method="post" action="{% url 'delete_lesson' lesson.id %}" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" style="background:none; border:none; color:red; cursor:pointer; font-size:0.8em; padding:0;">âŒ</button>

                        </form>
                    </div>
                    {% endfor %}


                    <!-- å®¿é¡Œè¡¨ç¤º -->
                    {% for hw_entry in homeworks_by_day|get_item:day %}
                    <div style="background-color: #d0ebff; font-size: 0.8em; margin: 2px 0;">
                        {{ hw_entry.detail.homework.get_subject_display }}<br>
                        ğŸ« {{ hw_entry.detail.get_course_display }} / {{ hw_entry.detail.get_problem_type_display }}<br>
                        ğŸ“‹ {{ hw_entry.task }}

                        <!-- ğŸ”¥ å‰Šé™¤ãƒœã‚¿ãƒ³ -->
                        <form method="post" action="{% url 'delete_homework' hw_entry.detail.homework.id %}" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" style="background:none; border:none; color:red; cursor:pointer; font-size:0.8em; padding:0;">âŒ</button>
                        </form>
                    </div>
                {% endfor %}
                </div>
                {% if forloop.counter|divisibleby:7 %}
                    <div style="grid-column: 1 / -1;"></div>  <!-- 7æ—¥ã”ã¨ã«åŒºåˆ‡ã‚‹ -->
                {% endif %}
            {% endfor %}
        </div>





    <script>

        console.log("JS å‹•ã„ã¦ã‚‹ã‚ˆ");  // âœ… ã“ã‚Œã‚’ä¸€ç•ªä¸Šã«ï¼

        const subjectButtons = document.querySelectorAll('.subject-button');
        const subjectInput = document.getElementById('id_subject');
        console.log("subjectButtons:", subjectButtons);  // âœ… å–å¾—ã§ãã¦ã‚‹ã‹ï¼Ÿ

        const cycleButtons = document.querySelectorAll('.cycle-button');
        const cycleInput = document.getElementById('id_cycles');
        console.log("cycleButtons:", cycleButtons);  // âœ… å–å¾—ã§ãã¦ã‚‹ã‹ï¼Ÿ

        const days = document.querySelectorAll('.day');
        const selectedDatesInput = document.getElementById('selected_dates');
        const selectedDates = new Set();
    
        days.forEach(day => {
            day.addEventListener('click', () => {
                const dateStr = day.dataset.date;
                const isoDate = new Date(dateStr).toISOString().split('T')[0];  // ã“ã“ã§ ISOå½¢å¼ã«å¤‰æ›ï¼
                if (selectedDates.has(isoDate)) {
                    selectedDates.delete(isoDate);
                    day.classList.remove('selected');
                } else {
                    selectedDates.add(isoDate);
                    day.classList.add('selected');
                }
                selectedDatesInput.value = Array.from(selectedDates).join(',');
            });
        });



        // ç§‘ç›®é¸æŠ
        subjectButtons.forEach(button => {
            button.addEventListener('click', () => {
                if (button.classList.contains('selected')) {
                    // ã‚‚ã†ä¸€åº¦æŠ¼ã—ãŸã‚‰é¸æŠè§£é™¤
                    button.classList.remove('selected');
                    subjectInput.value = '';
                } else {
                    // ä»–ã®ãƒœã‚¿ãƒ³ã®é¸æŠè§£é™¤
                    subjectButtons.forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    subjectInput.value = button.dataset.value;
                }
            });
        });

        // å‘¨å›æ•°é¸æŠï¼ˆåŒã˜æµã‚Œï¼‰
        cycleButtons.forEach(button => {
            button.addEventListener('click', () => {
                if (button.classList.contains('selected')) {
                    button.classList.remove('selected');
                    cycleInput.value = '';
                } else {
                    cycleButtons.forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    cycleInput.value = button.dataset.value;
                }
            });
        });



        // ã‚³ãƒ¼ã‚¹é¸æŠ
        const courseButtons = document.querySelectorAll('.course-button');
        const courseInput = document.getElementById('id_course');
        courseButtons.forEach(button => {
            button.addEventListener('click', () => {
                if (button.classList.contains('selected')) {
                    button.classList.remove('selected');
                    courseInput.value = '';
                } else {
                    courseButtons.forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    courseInput.value = button.dataset.value;
                }
            });
        });

        // å•é¡Œã‚¿ã‚¤ãƒ—é¸æŠ
        const problemTypeButtons = document.querySelectorAll('.problem-type-button');
        const problemTypeInput = document.getElementById('id_problem_type');
        problemTypeButtons.forEach(button => {
            button.addEventListener('click', () => {
                if (button.classList.contains('selected')) {
                    button.classList.remove('selected');
                    problemTypeInput.value = '';
                } else {
                    problemTypeButtons.forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    problemTypeInput.value = button.dataset.value;
                }
            });
        });

        // å•é¡Œæ•°é¸æŠ
        const problemCountButtons = document.querySelectorAll('.problem-count-button');
        const problemCountInput = document.getElementById('id_problem_count');
        problemCountButtons.forEach(button => {
            button.addEventListener('click', () => {
                if (button.classList.contains('selected')) {
                    button.classList.remove('selected');
                    problemCountInput.value = '';
                } else {
                    problemCountButtons.forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    problemCountInput.value = button.dataset.value;
                }
            });
        });



    </script>
    
</body>
</html>
